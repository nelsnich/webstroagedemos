<!DOCTYPE html>
<html lang="en">
<head>
    <title>indexDb()</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script>
    var db;

    function indexedDBOk() {
        return "indexedDB" in window;
    }
 
    document.addEventListener("DOMContentLoaded", function() {
        if (!indexedDBOk) {
            window.alert("Your browser doesn't support a stable version of IndexedDB.")
        } else {
            var openRequest = indexedDB.open("idarticle_times",1);

            openRequest.onupgradeneeded = function(e) {
                var thisDB = e.target.result;
         
                if(!thisDB.objectStoreNames.contains("times")) {
                    thisDB.createObjectStore("times");
                }
            }

            openRequest.onsuccess = function(e) {
                console.log("running onsuccess");
 
                db = e.target.result;
                
                getAllItems(); //load the items
            };

            openRequest.onerror = function(e) {
                //Do something for the error
            } 
            
            $("#logForm").submit(function(){
                var newDate = new Date();
                var itemId = newDate.getTime();
                var values = new Array();
                var project = $("input[name='project']").val();
                var hours = $("input[name='hours']").val();
                var date = $("input[name='date']").val();

                if (project != "" && hours != "" && date != "") {
                    var transaction = db.transaction(["times"],"readwrite");
                    var store = transaction.objectStore("times");
                                 
                    var time = {
                        project:project,
                        hours:hours,
                        date:date
                    }

                    //Perform the add
                    var request = store.add(time,itemId);
                 
                    request.onerror = function(e) {
                        console.log("Error",e.target.error.name);
                        //some type of error handler
                    }
                 
                    request.onsuccess = function(e) {
                        console.log("Woot! Did it");
                    }
                } else {
                    alert("All fields are required.");
                }
            });
        }
    });
    
    function getAllItems() {
        var transaction = db.transaction(["times"], "readonly");
        var objectStore = transaction.objectStore("times");
         
        var cursor = objectStore.openCursor();
        
        var timeLog = ""; //the variable that will hold our html
        
        db.transaction(["times"], "readonly").objectStore("times").openCursor().onsuccess = function(e) {
            var cursor = e.target.result;
            if(cursor) {
                timeLog += '<li><strong>' + cursor.value.project + '</strong>: ' + cursor.value.hours + ' hours - ' + cursor.value.hours + '</li>';
                cursor.continue();
            }
            if (timeLog == "")
                timeLog = '<li class="empty">Log Currently Empty</li>';

            $("#theLog").html(timeLog); //update the ul with the list items
        }
    }
    </script>
</head>
<body>
    <form id="logForm" method="post">
        <input type="text" name="project" value="Project Name">
        <input type="number" name="hours" value="Hours" class="shortField">
        <input type="text" name="date" value="Date" class="shortField">
        <input type="submit" value="Log Time">
    </form>

    <ul id="theLog">
        <li>Loading&hellip;</li>
    </ul>
</body>
</html>